class Course{constructor(e,s,t,i,r,h,l,n){this.courseCode=e,this.courseTitle=s.replaceAll("&amp;","&").trim(),this.lang=t,this.credits=i,this.ects=r,this.classRestrictions=l,this.description=n.replaceAll("&amp;","&").trim(),this.lessons=[],this._createRequirementNames(h)}static createAutoGeneratedCourse(e){return new Course(e,"Auto Generated Course","",0,0,"","","")}_createRequirementNames(e){if(this._requirementNames=[],!e.includes("Yok")&&!(e.includes("planının")||e.includes("Diğer")||e.includes("Özel")||e.includes("için"))){var s=(e=e.replaceAll("veya","\nveya").replaceAll("ve","\nve").replaceAll("(","").replaceAll(")","")).split("\n");for(let e=0;e<s.length;e++){var t=s[e].trim().split(" ");if(0==e){this._requirementNames.push([t[0]+" "+t[1]]);continue}let i=t[1]+" "+t[2],r=t[0];"veya"==r?this._requirementNames[this._requirementNames.length-1].push(i):"ve"==r&&this._requirementNames.push([i])}}}connectCourses(e){this.requirements=[];for(let s=0;s<this._requirementNames.length;s++){this.requirements.push([]);for(let t=0;t<this._requirementNames[s].length;t++){let i=e.findCourseByCode(this._requirementNames[s][t]);null!=i&&this.requirements[s].push(i)}}}}class CourseGroup{constructor(e,s){this.courses=e,this.title=s}}class ITUHelper{LESSON_PATH="https://raw.githubusercontent.com/itu-helper/data/refs/heads/main/lessons.psv";COURSE_PATH="https://raw.githubusercontent.com/itu-helper/data/refs/heads/main/courses.psv";COURSE_PLAN_PATH="https://raw.githubusercontent.com/itu-helper/data/refs/heads/main/course_plans.txt";PROGRAMME_CODES_PATH="https://raw.githubusercontent.com/itu-helper/data/refs/heads/main/programme_codes.psv";BUILDING_CODES_PATH="https://raw.githubusercontent.com/itu-helper/data/refs/heads/main/building_codes.psv";constructor(){this._courses=[],this._semesters={},this._programmes=[],this._buildings=[],this.coursesDict={},this.fileFetchStatus=0,this.onFetchComplete=()=>{}}get courses(){return this._courses.length<=0&&(this._createCourses(),this._createProgrammes(),this._createBuildings(),this._createLessons(),this._connectAllCourses()),this._courses}get semesters(){return Object.keys(this._semesters).length<=0&&(this.courses,this._createSemesters()),this._semesters}get programmes(){return this._programmes.length<=0&&this._createProgrammes(),this._programmes}get buildings(){return this._buildings.length<=0&&this._createBuildings(),this._buildings}fetchData(){this._fetchTextFile(this.LESSON_PATH,e=>{this.lesson_lines=e.split("\n"),this._onTextFetchSuccess()}),this._fetchTextFile(this.COURSE_PATH,e=>{this.course_lines=e.split("\n"),this._onTextFetchSuccess()}),this._fetchTextFile(this.COURSE_PLAN_PATH,e=>{this.course_plan_lines=e.split("\n"),this._onTextFetchSuccess()}),this._fetchTextFile(this.PROGRAMME_CODES_PATH,e=>{this.programme_codes_lines=e.split("\n"),this._onTextFetchSuccess()}),this._fetchTextFile(this.BUILDING_CODES_PATH,e=>{this.building_codes_lines=e.split("\n"),this._onTextFetchSuccess()})}_onTextFetchSuccess(){this.fileFetchStatus++,this.fileFetchStatus>=5&&this.onFetchComplete()}_createCourses(){let e=this.course_lines;this._courses=[],this.coursesDict={};for(let s=0;s<e.length;s++){let t=e[s].replace("\r","");if(0==t.length)continue;let i=t.split("|");if(i.length<8)continue;let r=new Course(i[0],i[1],i[2],parseInt(i[3]),parseInt(i[4]),i[5],i[6],i[7]);this._courses.push(r)}this._courses.forEach(e=>{this.coursesDict[e.courseCode]=e})}_createLessons(){const e=this.programmes,s=this.buildings;let t=this.lesson_lines;for(let i=0;i<t.length;i++){let r=t[i].replace("\r","");if(0==r.length)continue;let h=r.split("|"),l=h[1],n=[];if("-"!==h[10].trim())for(const s of h[10].split(",")){let t=s.replace("_LS","").trim();for(const s of e)s.code===t&&n.push(s)}let c=null;for(const e of s)if(e.code===h[4].trim()){c=e;break}let o=new Lesson(h[0],l,h[2],h[3],c,h[5],h[6],h[7],h[8],h[9],n),u=this.findCourseByCode(l);u&&u.lessons.push(o)}}_createProgrammes(){this._programmes=[];let e=this.programme_codes_lines;for(let s=0;s<e.length;s++){let t=e[s].replace("\r","");if(0==t.length)continue;let i=t.split("|"),r=new Programme(i[0],i[1],i[2],i[3]);this._programmes.push(r)}}_createBuildings(){let e=this.building_codes_lines;for(let s=0;s<e.length;s++){let t=e[s].replace("\r","");if(0==t.length)continue;let i=t.split("|"),r=new Building(i[0],i[1],i[2]);this._buildings.push(r)}}_connectAllCourses(){this._courses.forEach(e=>{e.connectCourses(this)})}findCourseByCode(e){let s=this.coursesDict[e];if(null==s){if(""===e)return null;s=Course.createAutoGeneratedCourse(e),s.requirements=[],this._courses.push(s),this.coursesDict[e]=s}return s}_createSemesters(){let e="",s="",t="",i=[];this._semesters=[];let r=this.course_plan_lines;for(let h=0;h<r.length;h++){const l=r[h].replace("\r","").trim();if(l.includes("# ")){i=[];let r=l.split(" ")[0].length,h=l.slice(r+1).trim();1==r&&(e=h,this._semesters[e]={}),2==r&&(null!=this._semesters[e][s]&&(Object.keys(this._semesters[e][s]).length||delete this._semesters[e][s]),s=h,this._semesters[e][s]={}),3==r&&(t=h)}else{let r=[],h=l.split("=");for(let e=0;e<h.length;e++){let s=h[e];if("["===s[0]){s=s.replace("[","").replace("]","");let e=s.split("*");e[1]=e[1].replace("(","").replace(")","");let t=e[1].split("|"),i=[];t.forEach(e=>{i.push(this.findCourseByCode(e))}),r.push(new CourseGroup(i,e[0]))}else{let e=this.findCourseByCode(s);if(null==e)continue;r.push(e)}}i.push(r),8==i.length&&(this._semesters[e][s][t]=i)}}}_fetchTextFile(e,s){fetch(e).then(e=>e.text()).then(s).catch(e=>console.error(e))}}class Lesson{constructor(e,s,t,i,r,h,l,n,c,o,u){this.crn=e,this.course_code=s?.trim(),this.teachingMethod=t?.trim(),this.instructor=i?.trim(),this.building=r,this.time=l?.trim(),this.day=h?.trim(),this.room=n?.trim(),this.capacity=c,this.enrolled=o,this.majors=u}getStartAndEndTime(){const e=this.time.split("/");return[e[0].slice(0,2)+":"+e[0].slice(2),e[1].slice(0,2)+":"+e[1].slice(2)]}getDayAsNumber(){switch(this.day.toLowerCase()){case"pazartesi":return 0;case"salı":return 1;case"çarşamba":return 2;case"perşember":return 3;case"cuma":return 4;case"cumartesi":return 5;case"pazar":return 6;default:return-1}}}class Programme{constructor(e,s,t,i){this.code=e,this.name=s,this.faculty=t,this.faculty_code=i}}class Building{constructor(e,s,t){this.code=e,this.name=s,this.campus_name=t}}