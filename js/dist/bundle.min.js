class Course{constructor(e,s,t,r,i,h,c,n){this.courseCode=e,this.courseTitle=s,this.lang=t,this.credits=r,this.ects=i,this.classRestrictions=c,this.description=n,this.majorRestrictions="",this.lessons=[],this._createRequirementNames(h)}static createAutoGeneratedCourse(e){return new Course(e,"Auto Generated Course","",0,0,"","","")}_createRequirementNames(e){if(this._requirementNames=[],!e.includes("Yok")&&!(e.includes("planının")||e.includes("Diğer")||e.includes("Özel")||e.includes("için"))){var s=(e=e.replaceAll("veya","\nveya").replaceAll("ve","\nve").replaceAll("(","").replaceAll(")","")).split("\n");for(let e=0;e<s.length;e++){var t=s[e].trim().split(" ");if(0==e){this._requirementNames.push([t[0]+" "+t[1]]);continue}let r=t[1]+" "+t[2],i=t[0];"veya"==i?this._requirementNames[this._requirementNames.length-1].push(r):"ve"==i&&this._requirementNames.push([r])}}}connectCourses(e){this.requirements=[];for(let s=0;s<this._requirementNames.length;s++){this.requirements.push([]);for(let t=0;t<this._requirementNames[s].length;t++){let r=e.findCourseByCode(this._requirementNames[s][t]);null!=r&&this.requirements[s].push(r)}}}}class CourseGroup{constructor(e,s){this.courses=e,this.title=s}}class ITUHelper{LESSON_PATH="https://raw.githubusercontent.com/itu-helper/data/refs/heads/main/lessons.psv";COURSE_PATH="https://raw.githubusercontent.com/itu-helper/data/refs/heads/main/courses.psv";COURSE_PLAN_PATH="https://raw.githubusercontent.com/itu-helper/data/refs/heads/main/course_plans.txt";constructor(){this._courses=[],this._semesters={},this.coursesDict={},this.fileFetchStatus=0,this.onFetchComplete=()=>{}}get courses(){return this._courses.length<=0&&(this._createCourses(),this._courses.forEach((e=>{this.coursesDict[e.courseCode]=e})),this._createLessons(),this._connectAllCourses()),this._courses}get semesters(){return Object.keys(this._semesters).length<=0&&(this.courses,this._createSemesters()),this._semesters}fetchData(){this._fetchTextFile(this.LESSON_PATH,(e=>{this.lesson_lines=e.split("\n"),this._onTextFetchSuccess()})),this._fetchTextFile(this.COURSE_PATH,(e=>{this.course_lines=e.split("\n"),this._onTextFetchSuccess()})),this._fetchTextFile(this.COURSE_PLAN_PATH,(e=>{this.course_plan_lines=e.split("\n"),this._onTextFetchSuccess()}))}_onTextFetchSuccess(){this.fileFetchStatus++,this.fileFetchStatus>=3&&this.onFetchComplete()}_createCourses(){let e=this.course_lines;this._courses=[],this.coursesDict={};for(let s=0;s<e.length;s++){let t=e[s].replace("\r","");if(0==t.length)continue;let r=t.split("|");if(r.length<8)continue;let i=new Course(r[0],r[1],r[2],parseInt(r[3]),parseInt(r[4]),r[5],r[6],r[7]);this._courses.push(i)}}_createLessons(){let e=this.lesson_lines;for(let s=0;s<e.length;s++){let t=e[s].replace("\r","").split("|"),r=t[1],i=t[9],h=new Lesson(t[0],t[2],t[3],t[4],t[5],t[6],t[7],t[8]),c=this.findCourseByCode(r);c&&(c.lessons.push(h),c.majorRest=i)}}_connectAllCourses(){this._courses.forEach((e=>{e.connectCourses(this)}))}findCourseByCode(e){let s=this.coursesDict[e];if(null==s){if(""===e)return null;s=Course.createAutoGeneratedCourse(e),s.requirements=[],this._courses.push(s),this.coursesDict[e]=s}return s}_createSemesters(){let e="",s="",t="",r=[];this._semesters=[];let i=this.course_plan_lines;for(let h=0;h<i.length;h++){const c=i[h].replace("\r","").trim();if(c.includes("# ")){r=[];let i=c.split(" ")[0].length,h=c.slice(i+1).trim();1==i&&(e=h,this._semesters[e]={}),2==i&&(null!=this._semesters[e][s]&&(Object.keys(this._semesters[e][s]).length||delete this._semesters[e][s]),s=h,this._semesters[e][s]={}),3==i&&(t=h)}else{let i=[],h=c.split("=");for(let e=0;e<h.length;e++){let s=h[e];if("["===s[0]){s=s.replace("[","").replace("]","");let e=s.split("*");e[1]=e[1].replace("(","").replace(")","");let t=e[1].split("|"),r=[];t.forEach((e=>{r.push(this.findCourseByCode(e))})),i.push(new CourseGroup(r,e[0]))}else{let e=this.findCourseByCode(s);if(null==e)continue;i.push(e)}}r.push(i),8==r.length&&(this._semesters[e][s][t]=r)}}}_fetchTextFile(e,s){fetch(e).then((e=>e.text())).then(s).catch((e=>console.error(e)))}}class Lesson{constructor(e,s,t,r,i,h,c,n,l){this.crn=e,this.teachingMethod=s?.trim(),this.instructor=t?.trim(),this.building=r?.trim(),this.time=h?.trim(),this.day=i?.trim(),this.room=c?.trim(),this.capacity=n,this.enrolled=l}getStartAndEndTime(){const e=this.time.split("/");return[e[0].slice(0,2)+":"+e[0].slice(2),e[1].slice(0,2)+":"+e[1].slice(2)]}getDayAsNumber(){switch(this.day.toLowerCase()){case"pazartesi":return 0;case"salı":return 1;case"çarşamba":return 2;case"perşember":return 3;case"cuma":return 4;case"cumartesi":return 5;case"pazar":return 6;default:return-1}}}